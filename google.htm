<style>
    .googleButton {
        padding: 0px;
        padding-left:10px;
        padding-right:10px;
        border: 3px solid #ccc;
        background-color: #fafafa;
        color: #212121;
        min-width:50px;
        height:50px;
        border-radius: 25px;
        position: absolute;
        top:0px;
        right:0px;
    }
    .googleButton>img{
       width: 25px;
       height:25px;
    }
    .googleButton:hover{
        border: 3px solid #4885ed;;
        background-color: #ccc;
    }
    .googleButton>span{
        position:absolute;
        top:4px;
    }
    .googleButton:hover + #googlefiles{
        display:block;
    }

    .GoogleDrivefileBtn {
        width: 100%;
        background-color: #fafafa;
        margin-bottom: 10px;
        height: 150px;
        border: 0px;
    }

    .GoogleDrivefileBtn:hover {
        background-color: #ccc;
        cursor: pointer;
    }

    



</style>
<div class="text-center">
    <div id="GoogleDrivebuttons">
        <button id="authorize-button" class="googleButton "><img src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoV2luZG93cykiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6NDE5QzU4OTgyMzFBMTFFOTlFRDJCQUZBNUExNjY3OEUiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6NDE5QzU4OTkyMzFBMTFFOTlFRDJCQUZBNUExNjY3OEUiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo0MTlDNTg5NjIzMUExMUU5OUVEMkJBRkE1QTE2Njc4RSIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo0MTlDNTg5NzIzMUExMUU5OUVEMkJBRkE1QTE2Njc4RSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PuDHf0cAAAR5SURBVHja5FdLSJRRFL7+jo4PVFwkaq0MAhe5yGrXphbRi3TZotpIkbgJEumhUCqaldAuKogWLdqEElSbgsCFjyIIJESFQsHHqKOO46gzjn3f7T/Dmd9fty66cLz/3Mc53/nOuedeM7a2tsxeNMfsUQt0dXX5TpCJjIwM28fjcVNdXX3+EFosFotwnI19MpmU9XmZmZnT6N/K2K6G0YzQLYbSKHEsKVUDAwPvy8rK7O9EIpEGTLesrKwIug96XNbp3qFhLDbZ2dlGf0ufm5vLvZ2hUMj09fXZMVEmvQiVQjpkv+hjTwEjqd4RWv2E3q2trV2MRCJnioqKzMjIiJmYmDDBYND4JSWNb2xsVG1ubjZoMN41lkkVo5TIGBctLy+3kloiJ9L+/v5/VDk75yWMt6AL+jEj3451G0r4Q74ppAuJ1Ly6unqY9MALU1BQYGZnZ83o6KgNgQAV4JITALoP67u5T/QJ2JT4UeFm6/6lpaUWQSmNgAYHB22mE6h3XnQgRPXQcVSM6nUWBLwy0WjUwDPbU0CVWVxcbF9fXw9QuT5ieXl5nDNDQ0OpWPuB5xj0dOoQig6G0pFMk2xjLNGOAcBV/vbGnkLjw8PDC1gzx32+lQmewvApSC3Z8Yo1LEIl9AI0NesiIIaFLoLDfBNCcXm3IkEdiPU9oVuHMi01aRxoziGTL/gtFuNInhCMv4TST1j/U4dDg6UOzB/B93VhVMTxxCAYDoefaWr9YgSDd4V2KG7SbOgMV8frCbpSzZ6jSh0TqxVygOhEkTZKD2D0G4y9sCgRFnqNJOzR672JBobysadbn31HJqGgDBXqpk4oP0Uw0saCgj5VRHAy2na7GNyKdglrqlMxllisrKw8wOS246MpBOpeGO0lI4WFhWZsbMzO42x/B5DnfmdaOcb97a4e4/APsvg4vK0TD/RtpSiOIemu0Wh5ebkpKSkxU1NTtoSymqHdwL4/3lKqwwTHTsNWLetEgKUPCfWYiOitH2VuRtcVFxfPytVIwCyhVMLLY3p6OllZWXmltLT0qzch9fECO49ycnL6AkB7EkpO6OOjN7o1m5sqcEPdgtcF+N52NU1OTsahKwo2wtBVjJAkvbcTfjuQg9B3NoAi8AXZ2QMDNfRaFgsQUjszM0MArWSEieU9OipP7Fp3zPFmOvcjF4YQ1je23kHZHQzWaISkhWGYn5+3dNJzYUBfpRqAlF5JSn29SsOdcBtHN+G4hn9BnupKJd7Nzc3Z80qPeJHsFD8NWlc5XcVA8Tt4/DlVMt1z1gGq47IJCcCEsceA3wTiHok0I14QO4GiEyhObWm12kU2g8mHElfGC/G33uozTcN+pdFrUMqt+6KkY68x9oMV0j4EtALQcB+Kf9MYvZXbSr8euFYSbCe6aVTXAFC8tLCw0OjWdrvfIX0UF2ECfT3jyoRicunnkNwsEjP9bNLPJ6n18kIBe43AENIxD+Tn53ufNh/Hx8cbgKoCDCxLTL0G9Ln3/gOgkjQXesLQ8UqexSl2/rv/nf4KMAAv2tTKy+9nKQAAAABJRU5ErkJggg==' /></button>
        <button id="signout-button" class="googleButton "><img src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoV2luZG93cykiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6RDY4NTdENzgyMzE5MTFFOTlBRkZBMjc1RjEyMUY2OEEiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6RDY4NTdENzkyMzE5MTFFOTlBRkZBMjc1RjEyMUY2OEEiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpENjg1N0Q3NjIzMTkxMUU5OUFGRkEyNzVGMTIxRjY4QSIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpENjg1N0Q3NzIzMTkxMUU5OUFGRkEyNzVGMTIxRjY4QSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PlhQVREAAAYiSURBVHja5FdZiBxV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'></button>
    </div>
    <div id="googlefiles"></div>
</div>
<script src="https://apis.google.com/js/api.js"></script>
<script src="lib/js/jquery-3.3.1.min.js"></script>
<script>
    // Client ID and API key from the Developer Console
    var CLIENT_ID = '196875539919-18arpm8l3es472u2pjpf1vi8qgj3rdtl.apps.googleusercontent.com';
    var API_KEY = 'AIzaSyAuG0KiJEMyzQYEj6jFiWD476y6QxQY5V0';
    // Array of API discovery doc URLs for APIs used by the quickstart
    var DISCOVERY_DOCS = ["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"];
    // Authorization scopes required by the API; multiple scopes can be
    // included, separated by spaces.
    var SCOPES = 'https://www.googleapis.com/auth/drive.file';
    var pickerApiLoaded = false;
    var oauthToken
    var CurrentSelectedFile
    var SHOW_CREATE

    function GoogleDrivehandleClientLoad() {
        gapi.load('client:auth2', GoogleDriveInit);
    }


    function GoogleDriveInit() {
        gapi.client.init({
            apiKey: API_KEY,
            clientId: CLIENT_ID,
            discoveryDocs: DISCOVERY_DOCS,
            scope: SCOPES
        }).then(function () {

            // Listen for sign-in state changes.
            gapi.auth2.getAuthInstance().isSignedIn.listen(GoogleSigninStatus);
            // Handle the initial sign-in state.
            GoogleSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());

            $('#authorize-button').unbind().click(function () {
                gapi.auth2.getAuthInstance().signIn()
            });
            $('#signout-button').unbind().click(function () {
                gapi.auth2.getAuthInstance().signOut();
            });
        });
    }
    /**
     *  Called when the signed in status changes, to update the UI
     *  appropriately. After a sign-in, the API is called.
     */
    function GoogleSigninStatus(isSignedIn) {

        if (isSignedIn) {
            console.log("Signed In")
            $('#authorize-button').hide();
            $('#signout-button').show();
            GoogleDriveListFiles();
            $("#GoogleDriveloggedIn").show();
        } else {
            console.log("Signed Out")
            $('#authorize-button').show();
            $('#signout-button').hide();
            $('#googlefiles').html('');
        }

    }


    function GoogleDriveListFiles() {
        gapi.client.drive.files.list({
            'pageSize': 100,
            'fields': "nextPageToken, files(id, name)",
            'q': "name contains '.wavemakerData'",
        }).then(function (response) {
            var files = response.result.files;
            // get the first one found!

            if (files && files.length > 0) {
                console.log("File exists - using first one found")
                var file = files[0]
                console.log(file)
                $("#googlefiles").html('')
                $.each(files, function (k, f) {
                    newbutton = $(`<button class="btn btn-primary SelectGooglefile">${f.name}</button>`)
                    newbutton.data("fileobj", f)
                    $("#googlefiles").append(newbutton);
                    console.log(f)
                })
            }else{
                console.log("No datafile found - Creating");
                GoogleDriveCreateNewFile()
            }
        });
    }

    function GoogleDriveReadFileContents(file) {
        var request = gapi.client.drive.files.get({
            fileId: file.id,
            alt: 'media'
        })
        request.then(function (response) {
            wavemaker = JSON.parse(response.body);
            filename = file.name
            res = filename.replace(".wmproj", "")
            CURRENT_FILE_NAME = res.trim();
            CURRENT_FILE_OBJ = response;
            CURRENT_FILE_ID = file;
            console.log(filename)
            console.log(wavemaker)
        }, function (error) {
            //console.error(error)
        })
        return request; //for batch request
    }

    function GoogleDriveCreateNewFile() {
        newFilename = "WaveMaker" // probably use a timestamp 
        GoogleDriveCreateNewFileWrite(newFilename + ".wavemakerData", JSON.stringify(["hello", "bad"]))
    }


    function GoogleDriveCreateNewFileWrite(name, data, callback) {
        const boundary = '-------314159265358979323846';
        const delimiter = "\r\n--" + boundary + "\r\n";
        const close_delim = "\r\n--" + boundary + "--";
        const contentType = 'application/json';

        var metadata = {
            'name': name,
            'mimeType': contentType
        };

        var multipartRequestBody =
            delimiter +
            'Content-Type: application/json\r\n\r\n' +
            JSON.stringify(metadata) +
            delimiter +
            'Content-Type: ' + contentType + '\r\n\r\n' +
            data +
            close_delim;

        var request = gapi.client.request({
            'path': '/upload/drive/v3/files',
            'method': 'POST',
            'params': {
                'uploadType': 'multipart'
            },
            'headers': {
                'Content-Type': 'multipart/related; boundary="' + boundary + '"'
            },
            'body': multipartRequestBody
        });
        if (!callback) {
            callback = function (file) {
                CURRENT_FILE_OBJ = file;
                CURRENT_FILE_ID = file.id;
                CURRENT_FILE_NAME = name.replace(".wavemakerData", "").trim();
                GoogleDrivehandleClientLoad()
            };
        }
        request.execute(callback);
    }


    function GoogleDriveSaveFile() {
        fileID = CURRENT_FILE_ID;
        fileMetadata = CURRENT_FILE_OBJ.headers;
        data = JSON.stringify(wavemaker);
        const boundary = '-------314159265358979323846';
        const delimiter = "\r\n--" + boundary + "\r\n";
        const close_delim = "\r\n--" + boundary + "--";

        const contentType = 'application/json';

        var metadata = {
            'name': name,
            'mimeType': contentType
        };

        var multipartRequestBody =
            delimiter +
            'Content-Type: application/json\r\n\r\n' +
            JSON.stringify(metadata) +
            delimiter +
            'Content-Type: ' + contentType + '\r\n\r\n' +
            data +
            close_delim;

        var request = gapi.client.request({
            'path': '/upload/drive/v3/files/' + fileID,
            'method': 'PATCH',
            'params': {
                'uploadType': 'multipart'
            },
            'headers': {
                'Content-Type': 'multipart/related; boundary="' + boundary + '"'
            },
            'body': multipartRequestBody
        });

        callback = function (file) {
            autosaveTrigger = true;
            GoogleDriveInit()
        }
        request.execute(callback);
    }


    $(function () {
        GoogleDrivehandleClientLoad()
    })


    $(document).off("click", ".SelectGooglefile").on("click", ".SelectGooglefile", function () {
        console.log($(this).data("fileobj"))
    })

    $(document).off("click", "#newGooglefile").on("click", "#newGooglefile", function () {
        console.log("Creating New File")
        //           GoogleDriveCreateNewFile()
    })

</script>